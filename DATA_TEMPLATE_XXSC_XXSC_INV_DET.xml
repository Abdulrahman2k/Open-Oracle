<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Header: DATA_TEMPLATE_XXSC_XXSC_INV_DET.xml 115.0 2016/05/23 09:25:40 xdouser noship $ -->
<!-- dbdrv: none -->

<dataTemplate name="XXSC_HR_EMP_DETAILS" defaultPackage="XXSC_HR_PKG" version="1.0">
<properties>
<property name="xml_tag_case" value="upper" /> 
</properties>
<parameters>
  <parameter name="P_CONC_REQUEST_ID" dataType="number" /> 
  <parameter name="P_BU_ORG_ID" dataType="number" />
  </parameters>
  <lexicals /> 
 <dataQuery>
<sqlStatement name="Q_INV_DETAILS">
<![CDATA[  
SELECT msi.segment1 ITEM_CODE,
 msi.description, 
 MSI.EXPENSE_ACCOUNT,
 ITEM_CATEGORY.GL_FLEX_DESCRIPTION ACCOUNT_DESC,
 ITEM_CATEGORY.VALUE GL_ACCOUNT,
 ITEM_CATEGORY.CATEGORY_COMBINATION ITEM_CATEGORY,
  ITEM_CATEGORY.CATEGORY
--(SELECT CONCATENATED_SEGMENTS 
--FROM GL_CODE_COMBINATIONS_KFV 
--where CODE_COMBINATION_ID=msi.EXPENSE_ACCOUNT) GL_ACCOUNT,
--   
--   GL_FLEXFIELDS_PKG.GET_CONCAT_DESCRIPTION
--                                       (101,
--                                        MSI.EXPENSE_ACCOUNT
--                                       ) ACCOUNT_DESC
 
  FROM MTL_SYSTEM_ITEMS_B MSI, MTL_PARAMETERS MP,
   (
SELECT MIC.INVENTORY_ITEM_ID
, MCB.SEGMENT1||' - '||MCB.SEGMENT2 CATEGORY
,CAT.ORG_ID
,MIC.ORGANIZATION_ID
, CAT.CATEGORY_COMBINATION
, CAT.VALUE
, CAT.GL_FLEX_DESCRIPTION

FROM (SELECT RULE1.ORG_ID,
RULE1.CATEGORY_ID,
RULE1.RULE_VALUE CATEGORY_COMBINATION,
RULE2.SEGMENT_VALUE||'.'||RULE3.SEGMENT_VALUE VALUE,
RULE2.DESCRIPTION||'.'||RULE3.DESCRIPTION GL_FLEX_DESCRIPTION
FROM 
( SELECT DISTINCT RULE1.RULE_VALUE_ID,
MCK.CATEGORY_ID, 
MCK.CONCATENATED_SEGMENTS RULE_VALUE,
RULE1.ORG_ID 
FROM PO_RULE_EXPENSE_ACCOUNTS RULE1,
    MTL_CATEGORIES_KFV MCK
WHERE  RULE1.RULE_VALUE_ID = MCK.CATEGORY_ID
--  AND RULE1.ORG_ID        =  FND_PROFILE.VALUE('ORG_ID')
  ) RULE1,
  
  ( SELECT  PO_RULE.RULE_VALUE_ID,
    PO_RULE.SEGMENT_NUM,
    FFSV.SEGMENT_NAME SEGMENT_NAME,
    PO_RULE.SEGMENT_VALUE,
    PO_RULE.ORG_ID ORG_ID,
--    FFSV.DESCRIPTION,
    ( SELECT FFVT.DESCRIPTION -- FLEX_VALUE_MEANING
FROM  FND_FLEX_VALUES_VL FFVT
WHERE FFVT.FLEX_VALUE=PO_RULE.SEGMENT_VALUE
 AND   FFVT.FLEX_VALUE_SET_ID =FFSV.FLEX_VALUE_SET_ID ) DESCRIPTION
    FROM PO_RULE_EXPENSE_ACCOUNTS PO_RULE,
    FND_ID_FLEX_SEGMENTS_VL FFSV
  WHERE FFSV.ID_FLEX_NUM                   = 101
  AND FFSV.APPLICATION_ID                  = 101
  AND FFSV.ID_FLEX_CODE                    = 'GL#'
  AND PO_RULE.SEGMENT_NUM   = FFSV.APPLICATION_COLUMN_NAME
  AND FFSV.APPLICATION_COLUMN_NAME ='SEGMENT4'
--  AND PO_RULE.RULE_VALUE_ID = 2140
--  AND  PO_RULE.ORG_ID        =  FND_PROFILE.VALUE('ORG_ID')
  ) RULE2,
    ( SELECT  PO_RULE.RULE_VALUE_ID,
    PO_RULE.SEGMENT_NUM,
    FFSV.SEGMENT_NAME SEGMENT_NAME,
    PO_RULE.SEGMENT_VALUE,
    PO_RULE.ORG_ID ORG_ID,
--    FFSV.DESCRIPTION,
    ( SELECT FFVT.DESCRIPTION -- FLEX_VALUE_MEANING
  FROM  FND_FLEX_VALUES_VL FFVT
WHERE FFVT.FLEX_VALUE=PO_RULE.SEGMENT_VALUE
 AND   FFVT.FLEX_VALUE_SET_ID =FFSV.FLEX_VALUE_SET_ID ) DESCRIPTION
    FROM PO_RULE_EXPENSE_ACCOUNTS PO_RULE,
    FND_ID_FLEX_SEGMENTS_VL FFSV
  WHERE FFSV.ID_FLEX_NUM                   = 101
  AND FFSV.APPLICATION_ID                  = 101
  AND FFSV.ID_FLEX_CODE                    = 'GL#'
  AND PO_RULE.SEGMENT_NUM   = FFSV.APPLICATION_COLUMN_NAME
  AND FFSV.APPLICATION_COLUMN_NAME ='SEGMENT5'
--  AND PO_RULE.RULE_VALUE_ID = 2140
--  AND  PO_RULE.ORG_ID        =  FND_PROFILE.VALUE('ORG_ID')
  ) RULE3
  WHERE RULE1.RULE_VALUE_ID = RULE2.RULE_VALUE_ID
  AND RULE2.RULE_VALUE_ID = RULE3.RULE_VALUE_ID
  AND  RULE1.ORG_ID = RULE2.ORG_ID
  AND RULE2.ORG_ID = RULE3.ORG_ID) CAT,
        MTL_CATEGORY_SETS_TL CST,
        MTL_ITEM_CATEGORIES_V MIC, 
        MTL_CATEGORIES MCB 
    WHERE  MIC.CATEGORY_ID = MCB.CATEGORY_ID 
    AND CAT.CATEGORY_ID = MCB.CATEGORY_ID
    AND MIC.CATEGORY_SET_ID = CST.CATEGORY_SET_ID 
--    AND MIC.ORGANIZATION_ID =  CAT.ORG_ID
--    AND MIC.INVENTORY_ITEM_ID = MSI.INVENTORY_ITEM_ID
    AND CST.CATEGORY_SET_NAME = 'SHUAA Item Category'
) ITEM_CATEGORY
 WHERE MP.ORGANIZATION_ID = MSI.ORGANIZATION_ID
  AND ITEM_CATEGORY.INVENTORY_ITEM_ID = MSI.INVENTORY_ITEM_ID
  AND ITEM_CATEGORY.ORGANIZATION_ID = MSI.ORGANIZATION_ID
   and MSI.ORGANIZATION_ID = :P_BU_ORG_ID
  ]]> 
  </sqlStatement>
  </dataQuery>
  <dataStructure>
<group name="G_EMP_DETAILS_GROUP" dataType="varchar2" source="Q_INV_DETAILS">
  <element name="ITEM_CODE"   dataType="VARCHAR2"    value="ITEM_CODE"/>
  <element name="DESCRIPTION"   dataType="VARCHAR2"    value="DESCRIPTION"/>
  <element name="EXPENSE_ACCOUNT"   dataType="VARCHAR2"    value="EXPENSE_ACCOUNT"/>
  <element name="ITEM_CATEGORY"   DATATYPE="VARCHAR2"    value="ITEM_CATEGORY"/>
  <element name="GL_ACCOUNT"   dataType="VARCHAR2"    value="GL_ACCOUNT"/>
  <element name="ACCOUNT_DESC"   dataType="VARCHAR2"    value="ACCOUNT_DESC"/>
</group>
  <element name="CURRENT_DATE"			dataType="date"		value="XXSC_HR_PKG.GET_CURRENT_DATE" /> 
  <element name="COMPANY_P"		        dataType="varchar2" value="XXSC_HR_PKG.GET_COMPANY_PARAM" /> 
  </dataStructure>
   </dataTemplate>